<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro de Despesa</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f6fa;
    }
    .container {
      max-width: 600px;
      margin: 50px auto;
      background: #fff;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
  .btn-voltar {
  font-size: 1.2rem;
  padding: 10px 25px;
  border-radius: 50px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  transition: transform 0.2s, box-shadow 0.2s;
}

  .btn-voltar:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 12px rgba(0,0,0,0.3);
  }

  </style>
</head>
<body>

<div class="container">
  <h1><i class="bi bi-plus-circle"></i> Nova Despesa</h1>
  <form id="formDespesa">
    <div class="mb-3">
      <label class="form-label"><i class="bi bi-card-text"></i> Descrição</label>
      <input type="text" class="form-control" id="descricao" placeholder="Ex: Supermercado, Conta de luz..." required>
    </div>

    <div class="mb-3">
      <label class="form-label"><i class="bi bi-cash-coin"></i> Valor Total</label>
      <input type="number" class="form-control" id="valorTotal" placeholder="Ex: 150.75" step="0.01" required>
    </div>

    <div class="mb-3">
      <label class="form-label"><i class="bi bi-tags"></i> Categoria</label>
      <select class="form-select" id="categoria" required>
        <option value="" selected disabled>Selecione...</option>
        <option>Alimentação</option>
        <option>Transporte</option>
        <option>Moradia</option>
        <option>Lazer</option>
        <option>Educação</option>
        <option>Outros</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label"><i class="bi bi-calendar-event"></i> Data</label>
      <input type="date" class="form-control" id="data" required>
    </div>

    <div class="mb-3">
     <label class="form-label"><i class="bi bi-credit-card"></i> Forma de pagamento</label>
     <select class="form-select" id="formaPagamento" onchange="mostrarParcelas()" required>    
       <option value="" selected disabled>Selecione...</option>
       <option value="DINHEIRO">Dinheiro</option>
       <option value="CARTAO_CREDITO">Cartão de Crédito</option>
       <option value="CARTAO_DEBITO">Cartão de Débito</option>
       <option value="PIX">PIX</option>
       <option value="BOLETO">Boleto</option>
  </select> </div>


    <div class="mb-3" id="campoParcelas" style="display:none;">
      <label class="form-label"><i class="bi bi-calendar2-check"></i> Número de parcelas</label>
      <input type="number" class="form-control" id="parcelas" min="1" value="1">
    </div>

    <button type="submit" class="btn btn-primary w-100"><i class="bi bi-save"></i> Salvar Despesa</button>
  </form>
</div>


<div class="text-center mt-4">
  <a href="./index.html" class="btn btn-primary btn-voltar" onclick="voltarAoMenu()">
    <i class="bi bi-house-door-fill"></i> Voltar ao Menu
  </a>
</div>


<script>

function mostrarParcelas() {
  const formaPagamento = document.getElementById('formaPagamento').value;
  const campoParcelas = document.getElementById('campoParcelas'); // div que envolve o input parcelas
  const inputParcelas = document.getElementById('parcelas');

  if (formaPagamento === "CARTAO_CREDITO") {
    campoParcelas.style.display = "block";   // mostra o campo
    inputParcelas.required = true;           // exige preenchimento
  } else {
    campoParcelas.style.display = "none";    // esconde o campo
    inputParcelas.required = false;          // não exige preenchimento
    inputParcelas.value = "";                // limpa o valor
  }
}



  const urlBase = "http://localhost:8080/api/despesas"; // URL do backend

  document.getElementById('formDespesa').addEventListener('submit', function(e) {
    e.preventDefault();

    // Captura dos valores do formulário
    const descricao = document.getElementById('descricao').value;
    const valorTotal = parseFloat(document.getElementById('valorTotal').value);
    const categoria = document.getElementById('categoria').value;
    const data = document.getElementById('data').value;    
    const formaPagamento = document.getElementById('formaPagamento').value;
    
    if (!formaPagamento) {
    alert("Selecione uma forma de pagamento válida!");
    return;   }

    const parcelas = parseInt(document.getElementById('parcelas').value);

    // Monta o objeto JSON compatível com o backend
    const despesa = {
      descricao: descricao,
      valorTotal: valorTotal,
      categoria: categoria,
      data: data,
      formaPagamento: formaPagamento,
      parcelas: parcelas
    };

    // Envia para o backend usando fetch
    fetch(urlBase, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(despesa)
    })
    .then(response => {
      if (!response.ok) {
        throw new Error("Erro ao cadastrar despesa");
      }
      return response.json();
    })
    .then(data => {
      alert("Despesa cadastrada com sucesso!");
      console.log("Despesa retornada pelo backend:", data);

      // Aqui você pode atualizar a tabela dinamicamente, chamando função que renderiza as despesas
      // ex: carregarDespesasDoMes(); ou adicionar linha na tabela diretamente

      // Limpar formulário
      document.getElementById('formDespesa').reset();
      mostrarParcelas(); // resetar campo parcelas se for cartão
    })
    .catch(error => {
      console.error("Erro:", error);
      alert("Falha ao cadastrar despesa!");
    });
  });
   
  function voltarAoMenu() {
  // Redireciona para a página inicial (menu.html)
  window.location.href = "index.html";
}

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
